# .github/workflows/publish.yml
name: Publish to Chrome Web Store

on:
    push:
        tags:
            - "v*" # 当推送 v1.0.0 这样的 tag 时触发

jobs:
    build-and-publish:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "22"
                  cache: "pnpm"

            - name: Setup pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: 10.11.0

            - name: Install dependencies
              run: pnpm install

            - name: Build
              run: pnpm build

            - name: Upload to Chrome Web Store
              uses: mobilefirstllc/cws-publish@latest
              with:
                  action: "publish" # 直接发布，或 "upload"
                  client_id: ${{ secrets.CHROME_CLIENT_ID }}
                  client_secret: ${{ secrets.CHROME_CLIENT_SECRET }}
                  refresh_token: ${{ secrets.CHROME_REFRESH_TOKEN }}
                  extension_id: ${{ secrets.CHROME_EXTENSION_ID }}
                  zip_file: "dist.zip"
