# .github/workflows/publish.yml
name: Publish to Chrome Web Store

on:
    push:
        tags:
            - "v*" # 当推送 v1.0.0 这样的 tag 时触发

jobs:
    build-and-publish:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Setup pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: 10

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "22"
                  cache: "pnpm"

            - name: Install dependencies
              run: pnpm install

            - name: Build
              run: pnpm build

            - name: Get version
              id: version
              run: echo "version=$(node -p "require('./package.json').version")" >> $GITHUB_OUTPUT

            - name: Upload & Publish to Chrome Web Store
              uses: PlasmoHQ/bpp@v3
              with:
                  keys: ${{ secrets.BPP_KEYS }}
                  artifact: "release/crx-sync-storage-${{ steps.version.outputs.version }}.zip"
